{"ast":null,"code":"import axios from 'axios';\nexport default {\n  name: 'UploadDialog',\n  props: {\n    visible: Boolean\n  },\n  data() {\n    return {\n      formData: {\n        title: '',\n        authors: '',\n        year: new Date().getFullYear()\n      },\n      selectedFile: null,\n      uploading: false\n    };\n  },\n  computed: {\n    canSubmit() {\n      return this.selectedFile && this.formData.title.trim() && this.formData.authors.trim() && this.formData.year;\n    }\n  },\n  methods: {\n    close() {\n      this.$emit('update:visible', false);\n      this.resetForm();\n    },\n    resetForm() {\n      this.formData = {\n        title: '',\n        authors: '',\n        year: new Date().getFullYear()\n      };\n      this.selectedFile = null;\n    },\n    triggerFileInput() {\n      this.$refs.fileInput.click();\n    },\n    handleFileChange(event) {\n      const file = event.target.files[0];\n      if (!file) return;\n      if (file.type !== 'application/pdf') {\n        alert('请选择PDF文件');\n        return;\n      }\n\n      // 限制文件大小为20MB\n      if (file.size > 20 * 1024 * 1024) {\n        alert('文件大小不能超过20MB');\n        return;\n      }\n      this.selectedFile = file;\n    },\n    formatFileSize(bytes) {\n      if (bytes === 0) return '0 B';\n      const k = 1024;\n      const sizes = ['B', 'KB', 'MB', 'GB'];\n      const i = Math.floor(Math.log(bytes) / Math.log(k));\n      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n    },\n    async submitUpload() {\n      if (!this.canSubmit) return;\n      this.uploading = true;\n      try {\n        const formData = new FormData();\n        formData.append('file', this.selectedFile);\n        formData.append('title', this.formData.title);\n        formData.append('authors', this.formData.authors);\n        formData.append('year', this.formData.year);\n        const response = await axios.post('http://localhost:8080/api/papers/upload', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n        if (response.data.code === 200) {\n          this.$emit('upload-success', response.data.data);\n          this.close();\n        }\n      } catch (error) {\n        console.error('上传失败:', error);\n        if (error.response?.data?.message) {\n          alert(error.response.data.message);\n        } else {\n          alert('上传失败，请重试');\n        }\n      } finally {\n        this.uploading = false;\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","name","props","visible","Boolean","data","formData","title","authors","year","Date","getFullYear","selectedFile","uploading","computed","canSubmit","trim","methods","close","$emit","resetForm","triggerFileInput","$refs","fileInput","click","handleFileChange","event","file","target","files","type","alert","size","formatFileSize","bytes","k","sizes","i","Math","floor","log","parseFloat","pow","toFixed","submitUpload","FormData","append","response","post","headers","code","error","console","message"],"sources":["src/components/UploadDialog.vue"],"sourcesContent":["<template>\n  <div class=\"upload-dialog\" v-if=\"visible\">\n    <div class=\"dialog-overlay\" @click=\"close\"></div>\n    <div class=\"dialog-content\">\n      <div class=\"dialog-header\">\n        <h3>上传论文</h3>\n        <div class=\"close-button\" @click=\"close\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n            stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n            <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n          </svg>\n        </div>\n      </div>\n\n      <div class=\"dialog-body\">\n        <div class=\"form-group\">\n          <label>PDF文件</label>\n          <div class=\"file-upload\">\n            <input\n              type=\"file\"\n              ref=\"fileInput\"\n              @change=\"handleFileChange\"\n              accept=\"application/pdf\"\n              style=\"display: none\"\n            >\n            <button class=\"upload-button\" @click=\"triggerFileInput\">\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"\n                stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\n                <polyline points=\"17 8 12 3 7 8\"></polyline>\n                <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"></line>\n              </svg>\n              选择PDF文件\n            </button>\n            <div class=\"file-info\" v-if=\"selectedFile\">\n              <div class=\"file-name\">{{ selectedFile.name }}</div>\n              <div class=\"file-size\">{{ formatFileSize(selectedFile.size) }}</div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"form-group\">\n          <label>论文标题</label>\n          <input type=\"text\" v-model=\"formData.title\" placeholder=\"请输入论文标题\">\n        </div>\n\n        <div class=\"form-group\">\n          <label>作者</label>\n          <input type=\"text\" v-model=\"formData.authors\" placeholder=\"请输入作者名称，多个作者用逗号分隔\">\n        </div>\n\n        <div class=\"form-group\">\n          <label>发表年份</label>\n          <input type=\"number\" v-model=\"formData.year\" placeholder=\"请输入发表年份\">\n        </div>\n      </div>\n\n      <div class=\"dialog-footer\">\n        <button class=\"cancel-button\" @click=\"close\">取消</button>\n        <button class=\"upload-submit-button\" @click=\"submitUpload\" :disabled=\"uploading || !canSubmit\">\n          {{ uploading ? '上传中...' : '上传' }}\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\n\nexport default {\n  name: 'UploadDialog',\n  props: {\n    visible: Boolean\n  },\n  data() {\n    return {\n      formData: {\n        title: '',\n        authors: '',\n        year: new Date().getFullYear()\n      },\n      selectedFile: null,\n      uploading: false\n    }\n  },\n  computed: {\n    canSubmit() {\n      return this.selectedFile && \n             this.formData.title.trim() && \n             this.formData.authors.trim() && \n             this.formData.year\n    }\n  },\n  methods: {\n    close() {\n      this.$emit('update:visible', false)\n      this.resetForm()\n    },\n\n    resetForm() {\n      this.formData = {\n        title: '',\n        authors: '',\n        year: new Date().getFullYear()\n      }\n      this.selectedFile = null\n    },\n\n    triggerFileInput() {\n      this.$refs.fileInput.click()\n    },\n    \n    handleFileChange(event) {\n      const file = event.target.files[0]\n      if (!file) return\n      \n      if (file.type !== 'application/pdf') {\n        alert('请选择PDF文件')\n        return\n      }\n      \n      // 限制文件大小为20MB\n      if (file.size > 20 * 1024 * 1024) {\n        alert('文件大小不能超过20MB')\n        return\n      }\n\n      this.selectedFile = file\n    },\n\n    formatFileSize(bytes) {\n      if (bytes === 0) return '0 B'\n      const k = 1024\n      const sizes = ['B', 'KB', 'MB', 'GB']\n      const i = Math.floor(Math.log(bytes) / Math.log(k))\n      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]\n    },\n\n    async submitUpload() {\n      if (!this.canSubmit) return\n\n      this.uploading = true\n      try {\n        const formData = new FormData()\n        formData.append('file', this.selectedFile)\n        formData.append('title', this.formData.title)\n        formData.append('authors', this.formData.authors)\n        formData.append('year', this.formData.year)\n\n        const response = await axios.post('http://localhost:8080/api/papers/upload', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        })\n\n        if (response.data.code === 200) {\n          this.$emit('upload-success', response.data.data)\n          this.close()\n        }\n      } catch (error) {\n        console.error('上传失败:', error)\n        if (error.response?.data?.message) {\n          alert(error.response.data.message)\n        } else {\n          alert('上传失败，请重试')\n        }\n      } finally {\n        this.uploading = false\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.upload-dialog {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n\n.dialog-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n}\n\n.dialog-content {\n  position: relative;\n  width: 400px;\n  background: white;\n  border-radius: 12px;\n  padding: 20px;\n  z-index: 1001;\n}\n\n.dialog-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.dialog-header h3 {\n  margin: 0;\n  font-size: 1.2rem;\n  color: #333;\n}\n\n.close-button {\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  transition: all 0.3s ease;\n}\n\n.close-button:hover {\n  background-color: #f5f5f5;\n}\n\n.form-group {\n  margin-bottom: 20px;\n  box-sizing: border-box;\n}\n\n.form-group label {\n  display: block;\n  margin-bottom: 8px;\n  color: #666;\n  font-size: 0.9rem;\n}\n\n.form-group input {\n  width: 380px;\n  padding: 8px 12px;\n  border: 1px solid #ddd;\n  border-radius: 6px;\n  font-size: 1rem;\n  transition: all 0.3s ease;\n}\n\n.form-group input:focus {\n  outline: none;\n  border-color: #764ba2;\n  box-shadow: 0 0 0 2px rgba(118, 75, 162, 0.1);\n}\n\n.file-upload {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.upload-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  padding: 12px;\n  background-color: #f5f5f5;\n  border: 2px dashed #ddd;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  width: 100%;\n  color: #666;\n  font-size: 0.9rem;\n}\n\n.upload-button:hover {\n  background-color: #eee;\n  border-color: #764ba2;\n  color: #764ba2;\n}\n\n.file-info {\n  background-color: #f5f5f5;\n  padding: 8px 12px;\n  border-radius: 6px;\n  font-size: 0.9rem;\n}\n\n.file-name {\n  color: #333;\n  word-break: break-all;\n  margin-bottom: 4px;\n}\n\n.file-size {\n  color: #666;\n  font-size: 0.8rem;\n}\n\n.dialog-footer {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  margin-top: 30px;\n}\n\n.cancel-button, .upload-submit-button {\n  padding: 8px 20px;\n  border-radius: 6px;\n  border: none;\n  font-size: 0.9rem;\n  cursor: pointer;\n  transition: all 0.3s ease;\n}\n\n.cancel-button {\n  background-color: #f5f5f5;\n  color: #666;\n}\n\n.cancel-button:hover {\n  background-color: #eee;\n}\n\n.upload-submit-button {\n  background-color: #764ba2;\n  color: white;\n}\n\n.upload-submit-button:hover:not(:disabled) {\n  background-color: #663e92;\n}\n\n.upload-submit-button:disabled {\n  opacity: 0.7;\n  cursor: not-allowed;\n}\n</style> "],"mappings":"AAqEA,OAAAA,KAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACAC,OAAA,EAAAC;EACA;EACAC,KAAA;IACA;MACAC,QAAA;QACAC,KAAA;QACAC,OAAA;QACAC,IAAA,MAAAC,IAAA,GAAAC,WAAA;MACA;MACAC,YAAA;MACAC,SAAA;IACA;EACA;EACAC,QAAA;IACAC,UAAA;MACA,YAAAH,YAAA,IACA,KAAAN,QAAA,CAAAC,KAAA,CAAAS,IAAA,MACA,KAAAV,QAAA,CAAAE,OAAA,CAAAQ,IAAA,MACA,KAAAV,QAAA,CAAAG,IAAA;IACA;EACA;EACAQ,OAAA;IACAC,MAAA;MACA,KAAAC,KAAA;MACA,KAAAC,SAAA;IACA;IAEAA,UAAA;MACA,KAAAd,QAAA;QACAC,KAAA;QACAC,OAAA;QACAC,IAAA,MAAAC,IAAA,GAAAC,WAAA;MACA;MACA,KAAAC,YAAA;IACA;IAEAS,iBAAA;MACA,KAAAC,KAAA,CAAAC,SAAA,CAAAC,KAAA;IACA;IAEAC,iBAAAC,KAAA;MACA,MAAAC,IAAA,GAAAD,KAAA,CAAAE,MAAA,CAAAC,KAAA;MACA,KAAAF,IAAA;MAEA,IAAAA,IAAA,CAAAG,IAAA;QACAC,KAAA;QACA;MACA;;MAEA;MACA,IAAAJ,IAAA,CAAAK,IAAA;QACAD,KAAA;QACA;MACA;MAEA,KAAAnB,YAAA,GAAAe,IAAA;IACA;IAEAM,eAAAC,KAAA;MACA,IAAAA,KAAA;MACA,MAAAC,CAAA;MACA,MAAAC,KAAA;MACA,MAAAC,CAAA,GAAAC,IAAA,CAAAC,KAAA,CAAAD,IAAA,CAAAE,GAAA,CAAAN,KAAA,IAAAI,IAAA,CAAAE,GAAA,CAAAL,CAAA;MACA,OAAAM,UAAA,EAAAP,KAAA,GAAAI,IAAA,CAAAI,GAAA,CAAAP,CAAA,EAAAE,CAAA,GAAAM,OAAA,aAAAP,KAAA,CAAAC,CAAA;IACA;IAEA,MAAAO,aAAA;MACA,UAAA7B,SAAA;MAEA,KAAAF,SAAA;MACA;QACA,MAAAP,QAAA,OAAAuC,QAAA;QACAvC,QAAA,CAAAwC,MAAA,cAAAlC,YAAA;QACAN,QAAA,CAAAwC,MAAA,eAAAxC,QAAA,CAAAC,KAAA;QACAD,QAAA,CAAAwC,MAAA,iBAAAxC,QAAA,CAAAE,OAAA;QACAF,QAAA,CAAAwC,MAAA,cAAAxC,QAAA,CAAAG,IAAA;QAEA,MAAAsC,QAAA,SAAA/C,KAAA,CAAAgD,IAAA,4CAAA1C,QAAA;UACA2C,OAAA;YACA;UACA;QACA;QAEA,IAAAF,QAAA,CAAA1C,IAAA,CAAA6C,IAAA;UACA,KAAA/B,KAAA,mBAAA4B,QAAA,CAAA1C,IAAA,CAAAA,IAAA;UACA,KAAAa,KAAA;QACA;MACA,SAAAiC,KAAA;QACAC,OAAA,CAAAD,KAAA,UAAAA,KAAA;QACA,IAAAA,KAAA,CAAAJ,QAAA,EAAA1C,IAAA,EAAAgD,OAAA;UACAtB,KAAA,CAAAoB,KAAA,CAAAJ,QAAA,CAAA1C,IAAA,CAAAgD,OAAA;QACA;UACAtB,KAAA;QACA;MACA;QACA,KAAAlB,SAAA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}