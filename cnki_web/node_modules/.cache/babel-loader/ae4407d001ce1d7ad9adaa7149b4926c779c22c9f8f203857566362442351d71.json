{"ast":null,"code":"import axios from 'axios';\nexport default {\n  name: 'SettingsDialog',\n  props: {\n    visible: Boolean,\n    currentSettings: Object\n  },\n  data() {\n    return {\n      formData: {\n        username: '',\n        password: '',\n        avatar: null,\n        nickname: ''\n      },\n      saving: false,\n      imagePreview: null,\n      selectedFileName: '',\n      selectedFile: null\n    };\n  },\n  watch: {\n    visible(newVal) {\n      if (newVal && this.currentSettings) {\n        this.formData = {\n          ...this.currentSettings,\n          password: ''\n        };\n        this.imagePreview = this.currentSettings.avatar;\n        this.selectedFileName = '';\n        this.selectedFile = null;\n      }\n    }\n  },\n  methods: {\n    close() {\n      this.$emit('update:visible', false);\n    },\n    triggerFileInput() {\n      this.$refs.fileInput.click();\n    },\n    handleFileChange(event) {\n      const file = event.target.files[0];\n      if (!file) return;\n\n      // 验证文件类型\n      if (!file.type.startsWith('image/')) {\n        alert('请选择图片文件');\n        return;\n      }\n\n      // 验证文件大小 (限制为2MB)\n      if (file.size > 2 * 1024 * 1024) {\n        alert('图片大小不能超过2MB');\n        return;\n      }\n      this.selectedFile = file;\n      this.selectedFileName = file.name;\n\n      // 创建预览\n      const reader = new FileReader();\n      reader.onload = e => {\n        this.imagePreview = e.target.result;\n      };\n      reader.readAsDataURL(file);\n    },\n    async saveSettings() {\n      if (!this.formData.username || !this.formData.nickname) {\n        alert('用户名和昵称不能为空');\n        return;\n      }\n      this.saving = true;\n      try {\n        const formData = new FormData();\n        // 添加当前用户名\n        formData.append('username', this.currentSettings.username);\n\n        // 如果用户名有修改，添加新用户名\n        if (this.formData.username !== this.currentSettings.username) {\n          formData.append('newUsername', this.formData.username);\n        }\n\n        // 如果有修改密码，添加新密码\n        if (this.formData.password) {\n          formData.append('password', this.formData.password);\n        }\n\n        // 如果昵称有修改，添加新昵称\n        if (this.formData.nickname !== this.currentSettings.nickname) {\n          formData.append('nickname', this.formData.nickname);\n        }\n\n        // 如果选择了新头像文件，直接添加文件\n        if (this.selectedFile) {\n          formData.append('avatar', this.selectedFile);\n        }\n\n        // 发送更新请求\n        const response = await axios.put('http://localhost:8080/api/user/update', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n        if (response.data.code === 200) {\n          // 更新成功后发送事件通知父组件\n          this.$emit('settings-updated', {\n            username: this.formData.username,\n            nickname: this.formData.nickname,\n            avatar: response.data.data.avatar || this.formData.avatar // 使用返回的新头像URL或保持原有的\n          });\n          this.close();\n        }\n      } catch (error) {\n        console.error('更新设置失败:', error);\n        alert('更新设置失败，请重试');\n      } finally {\n        this.saving = false;\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","name","props","visible","Boolean","currentSettings","Object","data","formData","username","password","avatar","nickname","saving","imagePreview","selectedFileName","selectedFile","watch","newVal","methods","close","$emit","triggerFileInput","$refs","fileInput","click","handleFileChange","event","file","target","files","type","startsWith","alert","size","reader","FileReader","onload","e","result","readAsDataURL","saveSettings","FormData","append","response","put","headers","code","error","console"],"sources":["src/components/SettingsDialog.vue"],"sourcesContent":["<template>\n  <div class=\"settings-dialog\" v-if=\"visible\">\n    <div class=\"dialog-overlay\" @click=\"close\"></div>\n    <div class=\"dialog-content\">\n      <div class=\"dialog-header\">\n        <h3>账户设置</h3>\n        <div class=\"close-button\" @click=\"close\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n            stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n            <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n          </svg>\n        </div>\n      </div>\n\n      <div class=\"dialog-body\">\n        <div class=\"form-group\">\n          <label>头像</label>\n          <div class=\"avatar-upload\">\n            <div class=\"avatar-preview\">\n              <img v-if=\"imagePreview\" :src=\"imagePreview\" alt=\"头像预览\">\n              <div v-else class=\"text-avatar\">{{ formData.nickname ? formData.nickname[0].toUpperCase() : 'U' }}</div>\n            </div>\n            <div class=\"upload-button-group\">\n              <input\n                type=\"file\"\n                ref=\"fileInput\"\n                @change=\"handleFileChange\"\n                accept=\"image/*\"\n                style=\"display: none\"\n              >\n              <button class=\"upload-button\" @click=\"triggerFileInput\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\"\n                  stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                  <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\n                  <polyline points=\"17 8 12 3 7 8\"></polyline>\n                  <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"></line>\n                </svg>\n                选择图片\n              </button>\n              <div class=\"file-name\" v-if=\"selectedFileName\">{{ selectedFileName }}</div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"form-group\">\n          <label>昵称</label>\n          <input type=\"text\" v-model=\"formData.nickname\" placeholder=\"请输入昵称\">\n        </div>\n\n        <div class=\"form-group\">\n          <label>用户名</label>\n          <input type=\"text\" v-model=\"formData.username\" placeholder=\"请输入用户名\">\n        </div>\n\n        <div class=\"form-group\">\n          <label>新密码</label>\n          <input type=\"password\" v-model=\"formData.password\" placeholder=\"不修改请留空\">\n        </div>\n      </div>\n\n      <div class=\"dialog-footer\">\n        <button class=\"cancel-button\" @click=\"close\">取消</button>\n        <button class=\"save-button\" @click=\"saveSettings\" :disabled=\"saving\">\n          {{ saving ? '保存中...' : '保存' }}\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\n\nexport default {\n  name: 'SettingsDialog',\n  props: {\n    visible: Boolean,\n    currentSettings: Object\n  },\n  data() {\n    return {\n      formData: {\n        username: '',\n        password: '',\n        avatar: null,\n        nickname: ''\n      },\n      saving: false,\n      imagePreview: null,\n      selectedFileName: '',\n      selectedFile: null\n    }\n  },\n  watch: {\n    visible(newVal) {\n      if (newVal && this.currentSettings) {\n        this.formData = {\n          ...this.currentSettings,\n          password: ''\n        }\n        this.imagePreview = this.currentSettings.avatar\n        this.selectedFileName = ''\n        this.selectedFile = null\n      }\n    }\n  },\n  methods: {\n    close() {\n      this.$emit('update:visible', false)\n    },\n    triggerFileInput() {\n      this.$refs.fileInput.click()\n    },\n    \n    handleFileChange(event) {\n      const file = event.target.files[0]\n      if (!file) return\n      \n      // 验证文件类型\n      if (!file.type.startsWith('image/')) {\n        alert('请选择图片文件')\n        return\n      }\n      \n      // 验证文件大小 (限制为2MB)\n      if (file.size > 2 * 1024 * 1024) {\n        alert('图片大小不能超过2MB')\n        return\n      }\n\n      this.selectedFile = file\n      this.selectedFileName = file.name\n      \n      // 创建预览\n      const reader = new FileReader()\n      reader.onload = e => {\n        this.imagePreview = e.target.result\n      }\n      reader.readAsDataURL(file)\n    },\n    async saveSettings() {\n      if (!this.formData.username || !this.formData.nickname) {\n        alert('用户名和昵称不能为空')\n        return\n      }\n\n      this.saving = true\n      try {\n        const formData = new FormData()\n        // 添加当前用户名\n        formData.append('username', this.currentSettings.username)\n        \n        // 如果用户名有修改，添加新用户名\n        if (this.formData.username !== this.currentSettings.username) {\n          formData.append('newUsername', this.formData.username)\n        }\n        \n        // 如果有修改密码，添加新密码\n        if (this.formData.password) {\n          formData.append('password', this.formData.password)\n        }\n        \n        // 如果昵称有修改，添加新昵称\n        if (this.formData.nickname !== this.currentSettings.nickname) {\n          formData.append('nickname', this.formData.nickname)\n        }\n        \n        // 如果选择了新头像文件，直接添加文件\n        if (this.selectedFile) {\n          formData.append('avatar', this.selectedFile)\n        }\n\n        // 发送更新请求\n        const response = await axios.put('http://localhost:8080/api/user/update', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        })\n\n        if (response.data.code === 200) {\n          // 更新成功后发送事件通知父组件\n          this.$emit('settings-updated', {\n            username: this.formData.username,\n            nickname: this.formData.nickname,\n            avatar: response.data.data.avatar || this.formData.avatar // 使用返回的新头像URL或保持原有的\n          })\n          this.close()\n        }\n      } catch (error) {\n        console.error('更新设置失败:', error)\n        alert('更新设置失败，请重试')\n      } finally {\n        this.saving = false\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.settings-dialog {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  \n}\n\n.dialog-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n}\n\n.dialog-content {\n  position: relative;\n  width: 400px;\n  background: white;\n  border-radius: 12px;\n  padding: 20px;\n  z-index: 1001;\n}\n\n.dialog-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.dialog-header h3 {\n  margin: 0;\n  font-size: 1.2rem;\n  color: #333;\n}\n\n.close-button {\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  transition: all 0.3s ease;\n}\n\n.close-button:hover {\n  background-color: #f5f5f5;\n}\n\n.form-group {\n  margin-bottom: 20px;\n  box-sizing: border-box;\n}\n\n.form-group label {\n  display: block;\n  margin-bottom: 8px;\n  color: #666;\n  font-size: 0.9rem;\n}\n\n.form-group input {\n  width: 380px;\n  padding: 8px 12px;\n  border: 1px solid #ddd;\n  border-radius: 6px;\n  font-size: 1rem;\n  transition: all 0.3s ease;\n}\n\n.form-group input:focus {\n  outline: none;\n  border-color: #764ba2;\n  box-shadow: 0 0 0 2px rgba(118, 75, 162, 0.1);\n}\n\n.avatar-upload {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.avatar-preview {\n  width: 60px;\n  height: 60px;\n  border-radius: 50%;\n  overflow: hidden;\n  background-color: #f5f5f5;\n}\n\n.avatar-preview img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.text-avatar {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  font-size: 1.5rem;\n  font-weight: bold;\n}\n\n.dialog-footer {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  margin-top: 30px;\n}\n\n.cancel-button, .save-button {\n  padding: 8px 20px;\n  border-radius: 6px;\n  border: none;\n  font-size: 0.9rem;\n  cursor: pointer;\n  transition: all 0.3s ease;\n}\n\n.cancel-button {\n  background-color: #f5f5f5;\n  color: #666;\n}\n\n.cancel-button:hover {\n  background-color: #eee;\n}\n\n.save-button {\n  background-color: #764ba2;\n  color: white;\n}\n\n.save-button:hover:not(:disabled) {\n  background-color: #663e92;\n}\n\n.save-button:disabled {\n  opacity: 0.7;\n  cursor: not-allowed;\n}\n\n.upload-button-group {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.upload-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  padding: 8px 16px;\n  background-color: #f5f5f5;\n  border: 1px dashed #ddd;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  color: #666;\n  font-size: 0.9rem;\n}\n\n.upload-button:hover {\n  background-color: #eee;\n  border-color: #764ba2;\n  color: #764ba2;\n}\n\n.file-name {\n  font-size: 0.8rem;\n  color: #666;\n  word-break: break-all;\n  padding: 4px 8px;\n  background-color: #f5f5f5;\n  border-radius: 4px;\n}\n\n.avatar-preview {\n  flex-shrink: 0;\n  width: 80px;\n  height: 80px;\n}\n</style> "],"mappings":"AAwEA,OAAAA,KAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACAC,OAAA,EAAAC,OAAA;IACAC,eAAA,EAAAC;EACA;EACAC,KAAA;IACA;MACAC,QAAA;QACAC,QAAA;QACAC,QAAA;QACAC,MAAA;QACAC,QAAA;MACA;MACAC,MAAA;MACAC,YAAA;MACAC,gBAAA;MACAC,YAAA;IACA;EACA;EACAC,KAAA;IACAd,QAAAe,MAAA;MACA,IAAAA,MAAA,SAAAb,eAAA;QACA,KAAAG,QAAA;UACA,QAAAH,eAAA;UACAK,QAAA;QACA;QACA,KAAAI,YAAA,QAAAT,eAAA,CAAAM,MAAA;QACA,KAAAI,gBAAA;QACA,KAAAC,YAAA;MACA;IACA;EACA;EACAG,OAAA;IACAC,MAAA;MACA,KAAAC,KAAA;IACA;IACAC,iBAAA;MACA,KAAAC,KAAA,CAAAC,SAAA,CAAAC,KAAA;IACA;IAEAC,iBAAAC,KAAA;MACA,MAAAC,IAAA,GAAAD,KAAA,CAAAE,MAAA,CAAAC,KAAA;MACA,KAAAF,IAAA;;MAEA;MACA,KAAAA,IAAA,CAAAG,IAAA,CAAAC,UAAA;QACAC,KAAA;QACA;MACA;;MAEA;MACA,IAAAL,IAAA,CAAAM,IAAA;QACAD,KAAA;QACA;MACA;MAEA,KAAAjB,YAAA,GAAAY,IAAA;MACA,KAAAb,gBAAA,GAAAa,IAAA,CAAA3B,IAAA;;MAEA;MACA,MAAAkC,MAAA,OAAAC,UAAA;MACAD,MAAA,CAAAE,MAAA,GAAAC,CAAA;QACA,KAAAxB,YAAA,GAAAwB,CAAA,CAAAT,MAAA,CAAAU,MAAA;MACA;MACAJ,MAAA,CAAAK,aAAA,CAAAZ,IAAA;IACA;IACA,MAAAa,aAAA;MACA,UAAAjC,QAAA,CAAAC,QAAA,UAAAD,QAAA,CAAAI,QAAA;QACAqB,KAAA;QACA;MACA;MAEA,KAAApB,MAAA;MACA;QACA,MAAAL,QAAA,OAAAkC,QAAA;QACA;QACAlC,QAAA,CAAAmC,MAAA,kBAAAtC,eAAA,CAAAI,QAAA;;QAEA;QACA,SAAAD,QAAA,CAAAC,QAAA,UAAAJ,eAAA,CAAAI,QAAA;UACAD,QAAA,CAAAmC,MAAA,qBAAAnC,QAAA,CAAAC,QAAA;QACA;;QAEA;QACA,SAAAD,QAAA,CAAAE,QAAA;UACAF,QAAA,CAAAmC,MAAA,kBAAAnC,QAAA,CAAAE,QAAA;QACA;;QAEA;QACA,SAAAF,QAAA,CAAAI,QAAA,UAAAP,eAAA,CAAAO,QAAA;UACAJ,QAAA,CAAAmC,MAAA,kBAAAnC,QAAA,CAAAI,QAAA;QACA;;QAEA;QACA,SAAAI,YAAA;UACAR,QAAA,CAAAmC,MAAA,gBAAA3B,YAAA;QACA;;QAEA;QACA,MAAA4B,QAAA,SAAA5C,KAAA,CAAA6C,GAAA,0CAAArC,QAAA;UACAsC,OAAA;YACA;UACA;QACA;QAEA,IAAAF,QAAA,CAAArC,IAAA,CAAAwC,IAAA;UACA;UACA,KAAA1B,KAAA;YACAZ,QAAA,OAAAD,QAAA,CAAAC,QAAA;YACAG,QAAA,OAAAJ,QAAA,CAAAI,QAAA;YACAD,MAAA,EAAAiC,QAAA,CAAArC,IAAA,CAAAA,IAAA,CAAAI,MAAA,SAAAH,QAAA,CAAAG,MAAA;UACA;UACA,KAAAS,KAAA;QACA;MACA,SAAA4B,KAAA;QACAC,OAAA,CAAAD,KAAA,YAAAA,KAAA;QACAf,KAAA;MACA;QACA,KAAApB,MAAA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}