{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport axios from 'axios';\nimport { debounce } from 'lodash';\nexport default {\n  name: 'HomePage',\n  data() {\n    return {\n      keyword: '',\n      username: 'Guest',\n      nickname: 'Rick',\n      userAvatar: null,\n      avatarLoadError: false,\n      searchValue: '',\n      selectedIndex: 0,\n      papers: [],\n      // 当前显示的论文列表\n      options: [{\n        text: \"recommend\",\n        icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3\"></path></svg>`\n      }, {\n        text: \"newest\",\n        icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle></svg>`\n      }, {\n        text: \"History\",\n        icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-clock\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><polyline points=\"12 6 12 12 16 14\"></polyline></svg>`\n      }, {\n        text: \"collect\",\n        icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-star\"><polygon points=\"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\"></polygon></svg>`\n      }],\n      searchHistory: [],\n      searchResult: [],\n      showMenu: false,\n      unreadCount: 3,\n      // 模拟未读消息\n      debouncedSearch: null,\n      loading: false,\n      showSearchPanel: false,\n      searchLoading: false\n    };\n  },\n  computed: {\n    greeting() {\n      const hour = new Date().getHours();\n      if (hour < 5) {\n        return 'Night Owl';\n      } else if (hour < 12) {\n        return 'Morning';\n      } else if (hour < 18) {\n        return 'Afternoon';\n      } else {\n        return 'Evening';\n      }\n    },\n    avatarInitial() {\n      if (this.nickname) {\n        return this.nickname.charAt(0).toUpperCase();\n      }\n      return this.username.charAt(0).toUpperCase();\n    }\n  },\n  methods: {\n    async getLatest() {\n      try {\n        const response = await axios.get(`http://localhost:8080/api/papers/latest`, {\n          params: {\n            username: this.username\n          }\n        });\n        this.papers = response.data.data;\n      } catch (error) {\n        console.error('获取最新论文失败', error);\n      }\n    },\n    async getRecommend() {\n      try {\n        const response = await axios.get(`http://localhost:8080/api/papers/recommend`, {\n          params: {\n            username: this.username,\n            limit: 100\n          }\n        });\n        this.papers = response.data.data;\n      } catch (error) {\n        console.error('获取推荐失败', error);\n      }\n    },\n    async handleSearch() {\n      console.log('搜索', this.keyword);\n      this.searchLoading = true;\n      try {\n        const response = await axios.get(`http://localhost:8080/api/papers/search?keyword=${this.keyword}&username=${this.username}`);\n        this.searchResult = response.data.data;\n        console.log(response);\n      } catch (error) {\n        console.error('搜索失败', error);\n      } finally {\n        this.searchLoading = false;\n      }\n    },\n    hideSearchPanel() {\n      setTimeout(() => {\n        this.showSearchPanel = false;\n      }, 200);\n    },\n    search() {\n      console.log('搜索', this.searchValue);\n    },\n    async selectOption(index) {\n      this.loading = true;\n      this.selectedIndex = index;\n      this.showSearchPanel = false; // 关闭搜索面板\n      try {\n        switch (index) {\n          case 0:\n            await this.getRecommend();\n            break;\n          case 1:\n            await this.getLatest();\n            break;\n          case 2:\n            await this.getHistory();\n            break;\n          case 3:\n            await this.getFavorites();\n            break;\n          case 4:\n            await this.getSearch();\n            break;\n        }\n      } finally {\n        this.loading = false;\n      }\n    },\n    handleAvatarError() {\n      this.avatarLoadError = true;\n      this.userAvatar = null; // 清空错误头像\n    },\n    showProfile() {\n      console.log('打开个人资料');\n    },\n    showNotifications() {\n      console.log('查看通知');\n    },\n    showSettings() {\n      console.log('打开设置');\n    },\n    logout() {\n      localStorage.removeItem('isLoggedIn');\n      this.$router.push('/');\n    },\n    async toggleFavorite(paperId) {\n      try {\n        const paper = this.papers.find(p => p.paperId === paperId);\n        if (!paper) return;\n        if (paper.isFavorited) {\n          // 取消收藏\n          const response = await axios.delete(`http://localhost:8080/api/papers/favorite`, {\n            params: {\n              username: this.username,\n              paperId: paperId\n            }\n          });\n          if (response.data.code === 200) {\n            this.updatePaperInList(response.data.data);\n            // 如果在收藏列表页面，立即移除该论文\n            if (this.selectedIndex === 3) {\n              this.papers = this.papers.filter(p => p.paperId !== paperId);\n            }\n          }\n        } else {\n          // 添加收藏\n          const response = await axios.post(`http://localhost:8080/api/papers/favorite`, null, {\n            params: {\n              username: this.username,\n              paperId: paperId\n            }\n          });\n          if (response.data.code === 200) {\n            this.updatePaperInList(response.data.data);\n          }\n        }\n      } catch (error) {\n        console.error('收藏操作失败', error);\n      }\n    },\n    updatePaperInList(paperData) {\n      const index = this.papers.findIndex(p => p.paperId === paperData.paperId);\n      if (index !== -1) {\n        this.$set(this.papers, index, {\n          ...this.papers[index],\n          isFavorited: paperData.isFavorited\n        });\n      }\n    },\n    viewPdf(pdfUrl, paperId) {\n      console.log('查看pdf', paperId);\n      window.open(pdfUrl, \"_blank\");\n      console.log('查看pdf', this.username, paperId);\n      axios.post(`http://localhost:8080/api/papers/view?username=${this.username}&paperId=${paperId}`).then(response => {\n        console.log(response);\n      }).catch(error => {\n        console.error('查看pdf失败', error);\n      });\n    },\n    async getHistory() {\n      try {\n        const response = await axios.get(`http://localhost:8080/api/papers/view-history`, {\n          params: {\n            username: this.username\n          }\n        });\n        this.papers = response.data.data;\n      } catch (error) {\n        console.error('获取浏览历史失败', error);\n      }\n    },\n    formatViewTime(timeString) {\n      if (!timeString) return '';\n      const viewTime = new Date(timeString);\n      const now = new Date();\n      const diff = now - viewTime;\n\n      // 小于1小时\n      if (diff < 3600000) {\n        const minutes = Math.floor(diff / 60000);\n        return `${minutes} 分钟前`;\n      }\n      // 小于24小时\n      if (diff < 86400000) {\n        const hours = Math.floor(diff / 3600000);\n        return `${hours} 小时前`;\n      }\n      // 小于7天\n      if (diff < 604800000) {\n        const days = Math.floor(diff / 86400000);\n        return `${days} 天前`;\n      }\n      // 其他情况显示具体日期\n      return viewTime.toLocaleDateString();\n    },\n    async getFavorites() {\n      try {\n        const response = await axios.get(`http://localhost:8080/api/papers/favorites`, {\n          params: {\n            username: this.username\n          }\n        });\n        this.papers = response.data.data;\n      } catch (error) {\n        console.error('获取收藏列表失败', error);\n      }\n    }\n  },\n  mounted() {\n    console.log(this.$route.params);\n    this.username = this.$route.params.username || '321';\n    this.nickname = this.$route.params.nickname || 'Rick';\n    this.userAvatar = this.$route.params.avatarUrl || null;\n    this.selectOption(0); // 默认加载推荐\n  },\n  created() {\n    this.debouncedSearch = debounce(this.handleSearch, 1000);\n  }\n};","map":{"version":3,"names":["axios","debounce","name","data","keyword","username","nickname","userAvatar","avatarLoadError","searchValue","selectedIndex","papers","options","text","icon","searchHistory","searchResult","showMenu","unreadCount","debouncedSearch","loading","showSearchPanel","searchLoading","computed","greeting","hour","Date","getHours","avatarInitial","charAt","toUpperCase","methods","getLatest","response","get","params","error","console","getRecommend","limit","handleSearch","log","hideSearchPanel","setTimeout","search","selectOption","index","getHistory","getFavorites","getSearch","handleAvatarError","showProfile","showNotifications","showSettings","logout","localStorage","removeItem","$router","push","toggleFavorite","paperId","paper","find","p","isFavorited","delete","code","updatePaperInList","filter","post","paperData","findIndex","$set","viewPdf","pdfUrl","window","open","then","catch","formatViewTime","timeString","viewTime","now","diff","minutes","Math","floor","hours","days","toLocaleDateString","mounted","$route","avatarUrl","created"],"sources":["src/views/Home.vue"],"sourcesContent":["<template>\n  <div class=\"background\">\n    <div class=\"navbar\">\n\n      <div class=\"option-tools\">\n        <div v-for=\"(option, index) in options\" :key=\"index\"\n          :class=\"['option-icon', { selected: selectedIndex === index }]\" @click=\"selectOption(index)\">\n          <div v-html=\"option.icon\"></div>\n          <div class=\"recommend-text\">{{ option.text }}</div>\n        </div>\n        <form class=\"search-bar\" @submit.prevent=\"search\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\"\n            stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n            class=\"feather feather-search\">\n            <circle cx=\"11\" cy=\"11\" r=\"8\"></circle>\n            <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"></line>\n          </svg>\n          <input v-on:focus=\"showSearchPanel = true\" v-on:blur=\"hideSearchPanel\" v-model=\"keyword\" type=\"text\"\n            placeholder=\"Search...\" @input=\"debouncedSearch\">\n        </form>\n      </div>\n\n      <div class=\"user-menu\">\n\n        <div class=\"user-name-text\">{{ greeting }}, {{ nickname }}!</div>\n        <div class=\"user-menu-container\" @mouseenter=\"showMenu = true\" @mouseleave=\"showMenu = false\">\n          <div class=\"user-avatar\">\n            <!-- 头像加载成功时显示图片 -->\n            <img v-if=\"userAvatar\" :src=\"userAvatar\" alt=\"用户头像\" @error=\"handleAvatarError\" class=\"avatar-image\">\n\n            <!-- 头像为空时，显示文字头像 -->\n            <div v-else class=\"text-avatar\">\n              <div class=\"text-avatar-inner\">\n                {{ avatarInitial }}\n              </div>\n            </div>\n          </div>\n\n          <!-- 悬浮菜单 -->\n          <transition name=\"menu-fade\">\n            <div v-show=\"showMenu\" class=\"floating-menu\">\n              <div class=\"menu-header\">\n                <div class=\"user-info\">\n                  <div class=\"user-name\">{{ nickname }}</div>\n                  <div class=\"user-email\">{{ username }}</div>\n                </div>\n              </div>\n\n              <div class=\"menu-body\">\n                <div class=\"menu-item\" @click=\"showProfile\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                    stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n                    class=\"feather feather-user\">\n                    <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path>\n                    <circle cx=\"12\" cy=\"7\" r=\"4\"></circle>\n                  </svg> 个人资料\n                </div>\n                <div class=\"menu-item\" @click=\"showNotifications\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                    stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n                    class=\"feather feather-bell\">\n                    <path d=\"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9\"></path>\n                    <path d=\"M13.73 21a2 2 0 0 1-3.46 0\"></path>\n                  </svg> 消息通知\n                  <span class=\"badge\" v-if=\"unreadCount > 0\">{{ unreadCount }}</span>\n                </div>\n\n                <div class=\"menu-item\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                    stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n                    class=\"feather feather-upload\">\n                    <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\n                    <polyline points=\"17 8 12 3 7 8\"></polyline>\n                    <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"></line>\n                  </svg>上传文件g t g h b\n                </div>\n                <div class=\"menu-item\" @click=\"showSettings\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                    stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n                    class=\"feather feather-settings\">\n                    <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\n                    <path\n                      d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\">\n                    </path>\n                  </svg> 账户设置\n                </div>\n                <div class=\"divider\"></div>\n                <div class=\"menu-item logout\" @click=\"logout\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                    stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n                    class=\"feather feather-log-out\">\n                    <path d=\"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4\"></path>\n                    <polyline points=\"16 17 21 12 16 7\"></polyline>\n                    <line x1=\"21\" y1=\"12\" x2=\"9\" y2=\"12\"></line>\n                  </svg> 退出登录\n                </div>\n              </div>\n            </div>\n          </transition>\n        </div>\n      </div>\n\n    </div>\n\n    <div class=\"content\">\n      <!-- 加载动画 -->\n      <div v-if=\"loading\" class=\"loading-container\">\n        <div class=\"loading-spinner\"></div>\n        <div class=\"loading-text\">加载中...</div>\n      </div>\n\n      <div v-else-if=\"showSearchPanel\">\n        <div v-if=\"searchLoading\" class=\"search-loading-container\">\n          <div class=\"loading-spinner\"></div>\n          <div>Searching...</div>\n        </div>\n        <div v-else-if=\"searchResult.length > 0\" class=\"recommend\">\n          <div class=\"recommend-item\" v-for=\"item in searchResult\" :key=\"item.paperId\">\n            <img :src=\"item.pdfUrl\" alt=\"pdf\" class=\"pdf-view\">\n            <div class=\"item-text\">\n              <div class=\"item-title\">{{ item.title }}</div>\n              <div class=\"item-author\">{{ item.authors }}</div>\n              <div class=\"item-year\">{{ item.year }}</div>\n              <div v-if=\"selectedIndex === 2\" class=\"view-time\">\n                {{ formatViewTime(item.viewTime) }}\n              </div>\n              <div v-if=\"selectedIndex === 3\" class=\"favorite-time\">\n                {{ formatViewTime(item.favoriteTime) }}\n              </div>\n            </div>\n\n            <div class=\"pdf-button\">\n              <div class=\"tools-button\">\n\n                <div :class=\"['collect-button', { 'selected': item.isFavorited }]\" @click=\"toggleFavorite(item.paperId)\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                    stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n                    class=\"feather feather-star\">\n                    <polygon\n                      points=\"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\">\n                    </polygon>\n                  </svg>\n                  <div class=\"collect-text\">{{ item.isFavorited ? '已收藏' : '收藏' }}</div>\n                </div>\n              </div>\n\n              <div class=\"tools-button\">\n                <div class=\"pdf-download-button\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                    stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n                    class=\"feather feather-download\">\n                    <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\n                    <polyline points=\"7 10 12 15 17 10\"></polyline>\n                    <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line>\n                  </svg>\n                  <div class=\"pdf-download-text\">download</div>\n                </div>\n\n                <div class=\"pdf-view-button\" @click=\"viewPdf(item.pdfUrl, item.paperId)\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                    stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n                    class=\"feather feather-book-open\">\n                    <path d=\"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z\"></path>\n                    <path d=\"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z\"></path>\n                  </svg>\n                  <div class=\"pdf-view-text\">view</div>\n                </div>\n              </div>\n\n            </div>\n          </div>\n        </div>\n        <div v-else-if=\"searchHistory.length > 0\" class=\"recommend\">\n          <div class=\"recommend-item\" v-for=\"item in searchHistory\" :key=\"item.paperId\">\n            <img :src=\"item.pdfUrl\" alt=\"pdf\" class=\"pdf-view\">\n            <div class=\"item-text\">\n              <div class=\"item-title\">{{ item.title }}</div>\n              <div class=\"item-author\">{{ item.authors }}</div>\n              <div class=\"item-year\">{{ item.year }}</div>\n              <div v-if=\"selectedIndex === 2\" class=\"view-time\">\n                {{ formatViewTime(item.viewTime) }}\n              </div>\n              <div v-if=\"selectedIndex === 3\" class=\"favorite-time\">\n                {{ formatViewTime(item.favoriteTime) }}\n              </div>\n            </div>\n\n            <div class=\"pdf-button\">\n              <div class=\"tools-button\">\n\n                <div :class=\"['collect-button', { 'selected': item.isFavorited }]\" @click=\"toggleFavorite(item.paperId)\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                    stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n                    class=\"feather feather-star\">\n                    <polygon\n                      points=\"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\">\n                    </polygon>\n                  </svg>\n                  <div class=\"collect-text\">{{ item.isFavorited ? '已收藏' : '收藏' }}</div>\n                </div>\n              </div>\n\n              <div class=\"tools-button\">\n                <div class=\"pdf-download-button\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                    stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n                    class=\"feather feather-download\">\n                    <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\n                    <polyline points=\"7 10 12 15 17 10\"></polyline>\n                    <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line>\n                  </svg>\n                  <div class=\"pdf-download-text\">download</div>\n                </div>\n\n                <div class=\"pdf-view-button\" @click=\"viewPdf(item.pdfUrl, item.paperId)\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                    stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n                    class=\"feather feather-book-open\">\n                    <path d=\"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z\"></path>\n                    <path d=\"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z\"></path>\n                  </svg>\n                  <div class=\"pdf-view-text\">view</div>\n                </div>\n              </div>\n\n            </div>\n          </div>\n        </div>\n        <div v-else class=\"search-history-empty\">\n          <div class=\"search-history-empty-title\">No search history yet.</div>\n        </div>\n      </div>\n\n      <div v-else class=\"recommend\">\n        <div class=\"recommend-item\" v-for=\"item in papers\" :key=\"item.paperId\">\n          <img :src=\"item.pdfUrl\" alt=\"pdf\" class=\"pdf-view\">\n          <div class=\"item-text\">\n            <div class=\"item-title\">{{ item.title }}</div>\n            <div class=\"item-author\">{{ item.authors }}</div>\n            <div class=\"item-year\">{{ item.year }}</div>\n            <div v-if=\"selectedIndex === 2\" class=\"view-time\">\n              {{ formatViewTime(item.viewTime) }}\n            </div>\n            <div v-if=\"selectedIndex === 3\" class=\"favorite-time\">\n              {{ formatViewTime(item.favoriteTime) }}\n            </div>\n          </div>\n\n          <div class=\"pdf-button\">\n            <div class=\"tools-button\">\n\n              <div :class=\"['collect-button', { 'selected': item.isFavorited }]\" @click=\"toggleFavorite(item.paperId)\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                  stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n                  class=\"feather feather-star\">\n                  <polygon\n                    points=\"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\">\n                  </polygon>\n                </svg>\n                <div class=\"collect-text\">{{ item.isFavorited ? '已收藏' : '收藏' }}</div>\n              </div>\n            </div>\n\n            <div class=\"tools-button\">\n              <div class=\"pdf-download-button\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                  stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n                  class=\"feather feather-download\">\n                  <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path>\n                  <polyline points=\"7 10 12 15 17 10\"></polyline>\n                  <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line>\n                </svg>\n                <div class=\"pdf-download-text\">download</div>\n              </div>\n\n              <div class=\"pdf-view-button\" @click=\"viewPdf(item.pdfUrl, item.paperId)\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                  stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n                  class=\"feather feather-book-open\">\n                  <path d=\"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z\"></path>\n                  <path d=\"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z\"></path>\n                </svg>\n                <div class=\"pdf-view-text\">view</div>\n              </div>\n            </div>\n\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\nimport { debounce } from 'lodash';\nexport default {\n  name: 'HomePage',\n  data() {\n    return {\n      keyword: '',\n      username: 'Guest',\n      nickname: 'Rick',\n      userAvatar: null,\n      avatarLoadError: false,\n      searchValue: '',\n      selectedIndex: 0,\n      papers: [], // 当前显示的论文列表\n      options: [\n        { text: \"recommend\", icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3\"></path></svg>` },\n        { text: \"newest\", icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle></svg>` },\n        { text: \"History\", icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-clock\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><polyline points=\"12 6 12 12 16 14\"></polyline></svg>` },\n        { text: \"collect\", icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-star\"><polygon points=\"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\"></polygon></svg>` }\n      ],\n      searchHistory: [],\n      searchResult: [],\n      showMenu: false,\n      unreadCount: 3, // 模拟未读消息\n      debouncedSearch: null,\n      loading: false,\n      showSearchPanel: false,\n      searchLoading: false\n    }\n  },\n  computed: {\n    greeting() {\n      const hour = new Date().getHours();\n      if (hour < 5) {\n        return 'Night Owl';\n      } else if (hour < 12) {\n        return 'Morning';\n      } else if (hour < 18) {\n        return 'Afternoon';\n      } else {\n        return 'Evening';\n      }\n    },\n    avatarInitial() {\n      if (this.nickname) {\n        return this.nickname.charAt(0).toUpperCase()\n      }\n      return this.username.charAt(0).toUpperCase()\n    }\n  },\n  methods: {\n    async getLatest() {\n      try {\n        const response = await axios.get(`http://localhost:8080/api/papers/latest`, {\n          params: {\n            username: this.username\n          }\n        });\n        this.papers = response.data.data;\n      } catch (error) {\n        console.error('获取最新论文失败', error);\n      }\n    },\n\n    async getRecommend() {\n      try {\n        const response = await axios.get(`http://localhost:8080/api/papers/recommend`, {\n          params: {\n            username: this.username,\n            limit: 100\n          }\n        });\n        this.papers = response.data.data;\n      } catch (error) {\n        console.error('获取推荐失败', error);\n      }\n    },\n\n    async handleSearch() {\n      console.log('搜索', this.keyword);\n      this.searchLoading = true;\n      try {\n        const response = await axios.get(`http://localhost:8080/api/papers/search?keyword=${this.keyword}&username=${this.username}`);\n        this.searchResult = response.data.data;\n        console.log(response);\n      } catch (error) {\n        console.error('搜索失败', error);\n      } finally {\n        this.searchLoading = false;\n      }\n    },\n\n    hideSearchPanel() {\n      setTimeout(() => {\n        this.showSearchPanel = false;\n      }, 200);\n    },\n\n    search() {\n      console.log('搜索', this.searchValue);\n    },\n    async selectOption(index) {\n      this.loading = true;\n      this.selectedIndex = index;\n      this.showSearchPanel = false; // 关闭搜索面板\n      try {\n        switch(index) {\n          case 0:\n            await this.getRecommend();\n            break;\n          case 1:\n            await this.getLatest();\n            break;\n          case 2:\n            await this.getHistory();\n            break;\n          case 3:\n            await this.getFavorites();\n            break;\n          case 4:\n            await this.getSearch();\n            break;\n        }\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    handleAvatarError() {\n      this.avatarLoadError = true\n      this.userAvatar = null // 清空错误头像\n    },\n    showProfile() {\n      console.log('打开个人资料');\n    },\n    showNotifications() {\n      console.log('查看通知');\n    },\n    showSettings() {\n      console.log('打开设置');\n    },\n    logout() {\n      localStorage.removeItem('isLoggedIn');\n      this.$router.push('/');\n    },\n    async toggleFavorite(paperId) {\n      try {\n        const paper = this.papers.find(p => p.paperId === paperId);\n        if (!paper) return;\n\n        if (paper.isFavorited) {\n          // 取消收藏\n          const response = await axios.delete(`http://localhost:8080/api/papers/favorite`, {\n            params: {\n              username: this.username,\n              paperId: paperId\n            }\n          });\n          if (response.data.code === 200) {\n            this.updatePaperInList(response.data.data);\n            // 如果在收藏列表页面，立即移除该论文\n            if (this.selectedIndex === 3) {\n              this.papers = this.papers.filter(p => p.paperId !== paperId);\n            }\n          }\n        } else {\n          // 添加收藏\n          const response = await axios.post(`http://localhost:8080/api/papers/favorite`, null, {\n            params: {\n              username: this.username,\n              paperId: paperId\n            }\n          });\n          if (response.data.code === 200) {\n            this.updatePaperInList(response.data.data);\n          }\n        }\n      } catch (error) {\n        console.error('收藏操作失败', error);\n      }\n    },\n\n    updatePaperInList(paperData) {\n      const index = this.papers.findIndex(p => p.paperId === paperData.paperId);\n      if (index !== -1) {\n        this.$set(this.papers, index, {\n          ...this.papers[index],\n          isFavorited: paperData.isFavorited\n        });\n      }\n    },\n\n    viewPdf(pdfUrl, paperId) {\n      console.log('查看pdf', paperId);\n      window.open(pdfUrl, \"_blank\")\n      console.log('查看pdf', this.username, paperId);\n      axios.post(`http://localhost:8080/api/papers/view?username=${this.username}&paperId=${paperId}`)\n        .then(response => {\n          console.log(response);\n        })\n        .catch(error => {\n          console.error('查看pdf失败', error);\n        })\n    },\n\n    async getHistory() {\n      try {\n        const response = await axios.get(`http://localhost:8080/api/papers/view-history`, {\n          params: {\n            username: this.username\n          }\n        });\n        this.papers = response.data.data;\n      } catch (error) {\n        console.error('获取浏览历史失败', error);\n      }\n    },\n\n    formatViewTime(timeString) {\n      if (!timeString) return '';\n      const viewTime = new Date(timeString);\n      const now = new Date();\n      const diff = now - viewTime;\n      \n      // 小于1小时\n      if (diff < 3600000) {\n        const minutes = Math.floor(diff / 60000);\n        return `${minutes} 分钟前`;\n      }\n      // 小于24小时\n      if (diff < 86400000) {\n        const hours = Math.floor(diff / 3600000);\n        return `${hours} 小时前`;\n      }\n      // 小于7天\n      if (diff < 604800000) {\n        const days = Math.floor(diff / 86400000);\n        return `${days} 天前`;\n      }\n      // 其他情况显示具体日期\n      return viewTime.toLocaleDateString();\n    },\n\n    async getFavorites() {\n      try {\n        const response = await axios.get(`http://localhost:8080/api/papers/favorites`, {\n          params: {\n            username: this.username\n          }\n        });\n        this.papers = response.data.data;\n      } catch (error) {\n        console.error('获取收藏列表失败', error);\n      }\n    },\n  },\n  mounted() {\n    console.log(this.$route.params);\n    this.username = this.$route.params.username || '321';\n    this.nickname = this.$route.params.nickname || 'Rick';\n    this.userAvatar = this.$route.params.avatarUrl || null;\n    this.selectOption(0); // 默认加载推荐\n  },\n  created() {\n    this.debouncedSearch = debounce(this.handleSearch, 1000);\n  }\n}\n</script>\n\n<style scoped src=\"../components/css/Home.css\"></style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}